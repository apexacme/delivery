steps:
  ### Build
  - id: 'build'
    name: 'gcr.io/cloud-builders/docker'
    entrypoint: 'bash'
    args:
      - '-c'
      - |
        mvn clean package -B
        docker build -t gcr.io/$PROJECT_ID/$PROJECT_NAME:$COMMIT_SHA .
  ### Test
  ### Publish
  - id: 'publish'
    name: 'gcr.io/cloud-builders/docker'
    entrypoint: 'bash'
    args:
      - '-c'
      - |
        docker push gcr.io/$PROJECT_ID/$PROJECT_NAME
  ### deploy
  - id: 'deploy'
    name: 'gcr.io/cloud-builders/kubectl'
    args:
      - set
      - image
      - deployment
      - serviceapi
      - serviceapi=gcr.io/$PROJECT_ID/$PROJECT_NAME:$COMMIT_SHA
    env:
      - 'CLOUDSDK_COMPUTE_ZONE=asia-northeast1-a'
      - 'CLOUDSDK_CONTAINER_CLUSTER=standard-cluster-1'